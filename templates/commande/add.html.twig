{% extends 'base.html.twig' %}

{% block stripe %}
<script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch"></script>
    <script src="https://js.stripe.com/v3/"></script> 
{% endblock %}
{% block title %}Paiement de ma commande - La Boutique Française
{% endblock %}



{% block body %}
	<div class="container">
		<h2>Mon récapitulatif</h2>
		<p>Vérifiez vos informations avant de payer votre commande.</p>
		<hr>
		<div class="row">
			<div class="col-md-6">
				<strong>Mon adresse de livraison</strong><br/>
				<div class="form-check mt-4">
					{{ livraison|raw }}
				</div>
				<hr>
				<strong>Mon transporteur</strong><br/>
				<div class="form-check">
					{{ transporteur.transporteurNom }}<br/>
					{{ transporteur.transporteurDescription }}<br/>
					{{ (transporteur.transporteurPrix)|number_format(2, ',', '.') }}
					€
				</div>
			</div>
			<div class="col-md-6">
				<div class="text-center">
					<b>Ma commande</b><br/>
				</div>
				<div class="order-summary">
					{% set total = null %}
					{% for key,produits in panier %}
						<div class="row {% if key > 0 %}mt-2{% endif %}">
							<div class="col-2">
								<img src="{{asset('build/images/theme/produit/'~ produits.produit.produitImages[0].imageName[0:4])}}/{{produits.produit.produitImages[0].imageName}}" alt="{{ produits.produit.produitLibelle }}" height="75px">
							</div>
							<div class="col-8 my-auto">
								{{ produits.produit.produitLibelle }}<br/>
								<small>
									{{ produits.produit.produitDescription }}
									<br/>
									x
									{{ produits.quantite }}
								</small>
							</div>

						{% if promo is defined and promo is not null %}
							<div class="col-2 my-auto">
								{{ ((produits.produit.produitPrix * produits.quantite - promo.codeMontant))|number_format(2, ',', '.')  }}
								€
							</div>
						</div>
							{% set total = total + (produits.produit.produitPrix * produits.quantite - promo.codeMontant) %}
						{% else %}
							<div class="col-2 my-auto">
								{{ ((produits.produit.produitPrix * produits.quantite))|number_format(2, ',', '.')  }}
								€
							</div>
						</div>
							{% set total = total + (produits.produit.produitPrix * produits.quantite) %}
						{% endif %}
					{% endfor %}
				</div>
				<hr>
				<strong>Sous-Total :
				</strong>
				{{ (total)|number_format(2, ',', '.') }}
				€<br/>
				<strong>Livraison :
				</strong>
				{{ (transporteur.transporteurPrix)|number_format(2, ',', '.') }}
				€
				<hr>
				<strong>Total :
				</strong>
				{{ ((total) + (transporteur.transporteurPrix))|number_format(2, ',', '.') }}
				€
                <br/>
				<a href="{{ path('stripe_create_session',{'reference':reference})}}" class="btn btn-success btn-block mt-3" id="checkout-button">Payer |
					{{ ((total) + (transporteur.transporteurPrix))|number_format(2, ',', '.') }}
					€</a>
			</div>
		</div>
	</div>
 
{% endblock %}

